


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.0">
    
    
      
        <title>Tutorial - CASPR</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.b5d04df8.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.9ab2c1f8.min.css">
      
      
        
        
        <meta name="theme-color" content="#4caf50">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-139052696-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorial" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="CASPR" class="md-header-nav__button md-logo" aria-label="CASPR">
      
  <img src="../images/logo.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            CASPR
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Tutorial
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/judithbergada/CASPR/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    judithbergada/CASPR
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CASPR" class="md-nav__button md-logo" aria-label="CASPR">
      
  <img src="../images/logo.svg" alt="logo">

    </a>
    CASPR
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/judithbergada/CASPR/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    judithbergada/CASPR
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../usage/" title="Usage" class="md-nav__link">
      Usage
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Tutorial
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Tutorial" class="md-nav__link md-nav__link--active">
      Tutorial
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#get-started-activate-conda-environment" class="md-nav__link">
    Get started: Activate Conda Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-case-1-analysis-of-a-crispr-screen-using-pgrnas" class="md-nav__link">
    User Case 1: Analysis of a CRISPR Screen Using pgRNAs
  </a>
  
    <nav class="md-nav" aria-label="User Case 1: Analysis of a CRISPR Screen Using pgRNAs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    Results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-case-2-analysis-of-a-crispr-screen-using-sgrnas" class="md-nav__link">
    User Case 2: Analysis of a CRISPR Screen Using sgRNAs
  </a>
  
    <nav class="md-nav" aria-label="User Case 2: Analysis of a CRISPR Screen Using sgRNAs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#results_1" class="md-nav__link">
    Results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#get-started-activate-conda-environment" class="md-nav__link">
    Get started: Activate Conda Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-case-1-analysis-of-a-crispr-screen-using-pgrnas" class="md-nav__link">
    User Case 1: Analysis of a CRISPR Screen Using pgRNAs
  </a>
  
    <nav class="md-nav" aria-label="User Case 1: Analysis of a CRISPR Screen Using pgRNAs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    Results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-case-2-analysis-of-a-crispr-screen-using-sgrnas" class="md-nav__link">
    User Case 2: Analysis of a CRISPR Screen Using sgRNAs
  </a>
  
    <nav class="md-nav" aria-label="User Case 2: Analysis of a CRISPR Screen Using sgRNAs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#results_1" class="md-nav__link">
    Results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/judithbergada/CASPR/tree/master/docs/pages/tutorial.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="tutorial">Tutorial</h1>
<p>Running CASPR is extremely easy and convenient to analyze CRIPR-Cas9 screens
using pgRNAs. The test data folder contains two brief user cases to go through
all steps. Simply copy the scripts provided in each user case to visualize the
demos.</p>
<h2 id="get-started-activate-conda-environment">Get started: Activate Conda Environment</h2>
<p>If it is your first time with CASPR, please follow the
<a href="../installation/">Installation Guide</a>.</p>
<p>After finishing with the installation, you should activate the Conda
Environment. Please, make sure you do it every time you work with CASPR:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Activate for Linux</span>
<span class="nb">source</span> activate caspr
<span class="c1"># Activate for macOS</span>
conda activate caspr
</code></pre></div>

<div class="admonition info">
<p class="admonition-title">Users of IBU Cluster</p>
<p>Users of IBU cluster (Interfaculty Bioinformatics Unit, University of Bern)
will also download CASPR following the
<a href="../installation/">Installation Guide</a>.</p>
<p>However, you do not need to poceed with the installation of a Conda
Environment. Instead, you can load the required software packages,
which are all installed in the cluster.</p>
<p>Please, make sure you load them every time you work with CASPR:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Import software: only for users of IBY cluster</span>
module add UHTS/Analysis/fastx_toolkit/0.0.13.2
module add UHTS/Aligner/STAR/2.6.0c
module add UHTS/Analysis/samtools/1.4
module add R/3.5.1
module add UHTS/Quality_control/mageck-vispr/0.5.4
</code></pre></div>

</div>
<h2 id="user-case-1-analysis-of-a-crispr-screen-using-pgrnas">User Case 1: Analysis of a CRISPR Screen Using pgRNAs</h2>
<p>This user case shows how to analyse a CRISPR screen with the following features:</p>
<ul>
<li>Library of <strong>pgRNAs</strong></li>
<li>Two time points: week zero and week four</li>
<li>Only one replicate per time point</li>
<li>Start analysis from the raw sequencing data</li>
</ul>
<p>To compute the analysis, it is essential to have:</p>
<ul>
<li>Paired reads</li>
<li>Text file with a library of pgRNAs</li>
<li>Text file with the experimental design (control and treated samples)</li>
</ul>
<p>Additionally, you may provide a text file with positive, negative and neutral
controls.</p>
<p>Let's go to the user case test data folder:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> <span class="nv">$HOME</span>/CASPR/testdata/pgrna
</code></pre></div>

<p>Let's check that the data is available in the expected formats:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check that the data has been sucessfully downoaded</span>
ls -al .

<span class="c1"># Display the content of the files to see the format</span>
cat expdesign.txt
head library.txt
head controlfile.txt
zcat &lt; week0.1_1.fastq.gz <span class="p">|</span> head
</code></pre></div>

<p>Now you are ready to run the example. If you are not sure about the commands,
you can copy them immediately from here:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create output directory</span>
mkdir results

<span class="c1"># Run the tool</span>
CASPR <span class="se">\</span>
  -f <span class="s2">&quot;week0.1_1.fastq.gz, week4.1_1.fastq.gz&quot;</span> <span class="se">\</span>
  -r <span class="s2">&quot;week0.1_2.fastq.gz, week4.1_2.fastq.gz&quot;</span> <span class="se">\</span>
  --library library.txt <span class="se">\</span>
  -y <span class="m">0</span>.25 -k <span class="se">\</span>
  --output-dir ./results <span class="se">\</span>
  --controls controlfile.txt <span class="se">\</span>
  --exper-design expdesign.txt
</code></pre></div>

<p>Note that, if you copy the commands from above, you are changing two of the
default parameters of CASPR:</p>
<ol>
<li>the FDR threshold <code>-y</code> will be set to 0.25, and</li>
<li>the intermediate files will be kept.</li>
</ol>
<p>Please, make sure you keep the intermediate files to follow the second part of
the user case.</p>
<h3 id="results">Results</h3>
<p>After a few minutes, the outputs should appear in your computer. At this point,
you can open them and see if they are as expected. The expected outputs are
found in:</p>
<div class="highlight"><pre><span></span><code>ls results/outputs
</code></pre></div>

<p>These are the outpus generated:</p>
<ul>
<li><a href="../assets/pgrna/Alignment_statistics.pdf">Alignment Statistics</a></li>
</ul>
<p><img src="../assets/pgrna/Alignment_statistics.png" alt="Alignment Statistics" width="40%"></p>
<ul>
<li><a href="../assets/pgrna/Comp_MAGeCK_PBNPA.pdf">Comparison of MAGeCK and PBNPA</a></li>
</ul>
<p><img src="../assets/pgrna/Comp_MAGeCK_PBNPA.png" alt="Comparison MAGeCK-PBNPA" width="40%"></p>
<ul>
<li><a href="../assets/pgrna/Log_counts.pdf">Log Counts</a></li>
</ul>
<p><img src="../assets/pgrna/Log_counts-0.png" alt="Log Counts" width="50%"><img src="../assets/pgrna/Log_counts-1.png" alt="Log Counts" width="50%"></p>
<ul>
<li><a href="../assets/pgrna/Selected_genes_MAGeCK.pdf">Selected Genes by MAGeCK</a></li>
</ul>
<p><img src="../assets/pgrna/Selected_genes_MAGeCK-0.png" alt="Selected Genes by MAGeCK" width="33.3%"><img src="../assets/pgrna/Selected_genes_MAGeCK-1.png" alt="Selected Genes by MAGeCK" width="33.3%"><img src="../assets/pgrna/Selected_genes_MAGeCK-2.png" alt="Selected Genes by MAGeCK" width="33.3%"></p>
<ul>
<li><a href="../assets/pgrna/Selected_genes_PBNPA.pdf">Selected Genes by PBNPA</a></li>
</ul>
<p><img src="../assets/pgrna/Selected_genes_PBNPA-0.png" alt="Selected Genes by PBNPA" width="50%"><img src="../assets/pgrna/Selected_genes_PBNPA-1.png" alt="Selected Genes by PBNPA" width="50%"></p>
<ul>
<li><a href="../assets/pgrna/Trimming_statistics.pdf">Trimming Statistics</a></li>
</ul>
<p><img src="../assets/pgrna/Trimming_statistics-2.png" alt="Trimming Statistics" width="33.3%"><img src="../assets/pgrna/Trimming_statistics-3.png" alt="Trimming Statistics" width="33.3%"><img src="../assets/pgrna/Trimming_statistics-4.png" alt="Trimming Statistics" width="33.3%"></p>
<p>Moreover, you can benefit from VISPR to get interactive results on you data.
Please try the following:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Run VIPR server</span>
vispr server ./results/config* --port <span class="m">5000</span>
<span class="c1"># Ctrl-C to exit the server</span>
</code></pre></div>

<div class="admonition info">
<p class="admonition-title">Users of IBU Cluster</p>
<p>VISPR installation in the IBU cluster might not be updated. Therefore,
users of this cluster will need to run an additional command to see
the outputs:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Take VISPR from jpijuan Conda Environment</span>
<span class="nb">alias</span> <span class="nv">vispr</span><span class="o">=</span><span class="s2">&quot;/home/jpijuan/miniconda3/envs/vispr/bin/vispr&quot;</span>

<span class="c1"># Run VIPR server</span>
vispr server ./results/config* --port <span class="m">5000</span>
<span class="c1"># Ctrl-C to exit the server</span>
</code></pre></div>

</div>
<p>VISPR is a web-based interactive server that creates a webpage with a nice visualization of the results.
If you are working from a cluster, you will also need to run this command locally on your computer:</p>
<div class="highlight"><pre><span></span><code>ssh -f <span class="o">{</span>user<span class="o">}</span>@binfservms01.unibe.ch -L <span class="m">5000</span>:localhost:5000 -N
</code></pre></div>

<p>Now, check the <a href="http://127.0.0.1:5000">webpage</a> on a browser and enjoy visualizing
the data.</p>
<p>If you are still curious about other options of CASPR, let's try to get more
information on the unmapped reads. This can be done esily just by adding the tag
<code>-i</code> to the previous command. Furthermore, if you kept the intermediate files
with the <code>-k</code> argument, neither the previous nor the next steps will be
necessary anymore (only mapping).</p>
<p>You can find a solution to quickly finish the user case here:</p>
<div class="highlight"><pre><span></span><code>CASPR <span class="se">\</span>
  -f <span class="s2">&quot;week0.1_1.fastq.gz, week4.1_1.fastq.gz&quot;</span> <span class="se">\</span>
  -r <span class="s2">&quot;week0.1_2.fastq.gz, week4.1_2.fastq.gz&quot;</span> <span class="se">\</span>
  --library library.txt <span class="se">\</span>
  -i --start map --pause map -y <span class="m">0</span>.25 -k <span class="se">\</span>
  --output-dir ./results <span class="se">\</span>
  --controls controlfile.txt <span class="se">\</span>
  --exper-design expdesign.txt
</code></pre></div>

<p>Check that everything worked out. Your outputs should look similar to:</p>
<ul>
<li><a href="../assets/pgrna/Alignment_statistics_2.pdf">Alignment Statistics</a></li>
</ul>
<p><img src="../assets/pgrna/Alignment_statistics_2-0.png" alt="Alignment Statistics" width="40%"><img src="../assets/pgrna/Alignment_statistics_2-1.png" alt="Alignment Statistics" width="40%"></p>
<p>If you arrived here, you finished the first user case successfully!</p>
<h2 id="user-case-2-analysis-of-a-crispr-screen-using-sgrnas">User Case 2: Analysis of a CRISPR Screen Using sgRNAs</h2>
<p>This user case shows how to analyse a CRISPR screen with the following features:</p>
<ul>
<li>Library of <strong>sgRNAs</strong></li>
<li>Two time points: week zero and week four</li>
<li>Two replicates per time point</li>
<li>Start analysis from the raw sequencing data</li>
</ul>
<p>To compute the analysis, it is essential to have:</p>
<ul>
<li>Single-read sequencing</li>
<li>Text file with a library of sgRNAs</li>
<li>Text file with the experimental design (control and treated samples)</li>
</ul>
<p>Moreover, you may provide a text file with positive, negative and neutral
controls, if interested.</p>
<p>In this user case, we want to analyse the two replicates separately in two
different tests, and we want to perform a third test using the replicates
together.</p>
<p>Let's go to the user case test data folder:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> <span class="nv">$HOME</span>/CASPR/testdata/sgrna
</code></pre></div>

<p>Before starting the tests, check that the data is available in the expected
formats. Pay special attention on the experimental design file, which allows to
obtain the results as required:</p>
<div class="highlight"><pre><span></span><code>cat expdesign.txt
head library.txt
head controlfile.txt
zcat &lt; week0.1.fastq.gz <span class="p">|</span> head
</code></pre></div>

<p>At this point, you are probably ready to try the analysis yourself. To get nicer
visualization of the outputs, it is recommended to use an FDR threshold of 0.25.</p>
<p>If you need further help, you can also use these commands:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create output directory</span>
mkdir results

<span class="c1"># Run the tool</span>
CASPR <span class="se">\</span>
  -f <span class="s2">&quot;week0.1.fastq.gz, week0.2.fastq.gz, week4.1.fastq.gz, week4.2.fastq.gz&quot;</span> <span class="se">\</span>
  --library library.txt <span class="se">\</span>
  -y <span class="m">0</span>.25 <span class="se">\</span>
  --output-dir ./results <span class="se">\</span>
  --controls controlfile.txt <span class="se">\</span>
  --exper-design expdesign.txt
</code></pre></div>

<h3 id="results_1">Results</h3>
<p>Quickly, the outputs should appear in your computer. You can open them and see
if they look as expected. The expected outputs are found in:</p>
<div class="highlight"><pre><span></span><code>ls results/outputs
</code></pre></div>

<p>These are the outpus generated:</p>
<ul>
<li><a href="../assets/sgrna/Alignment_statistics.pdf">Alignment Statistics</a></li>
</ul>
<p><img src="../assets/sgrna/Alignment_statistics.png" alt="Alignment Statistics" width="40%"></p>
<ul>
<li><a href="../assets/sgrna/Comp_MAGeCK_PBNPA.pdf">Comparison of MAGeCK and PBNPA</a></li>
</ul>
<p><img src="../assets/sgrna/Comp_MAGeCK_PBNPA-2.png" alt="Comparison MAGeCK-PBNPA" width="40%"></p>
<ul>
<li><a href="../assets/sgrna/Log_counts.pdf">Log Counts</a></li>
</ul>
<p><img src="../assets/sgrna/Log_counts-4.png" alt="Log Counts" width="50%"><img src="../assets/sgrna/Log_counts-5.png" alt="Log Counts" width="50%"></p>
<ul>
<li><a href="../assets/sgrna/Selected_genes_MAGeCK.pdf">Selected Genes by MAGeCK</a></li>
</ul>
<p><img src="../assets/sgrna/Selected_genes_MAGeCK-6.png" alt="Selected Genes by MAGeCK" width="33.3%"><img src="../assets/sgrna/Selected_genes_MAGeCK-7.png" alt="Selected Genes by MAGeCK" width="33.3%"><img src="../assets/sgrna/Selected_genes_MAGeCK-8.png" alt="Selected Genes by MAGeCK" width="33.3%"></p>
<ul>
<li><a href="../assets/sgrna/Selected_genes_PBNPA.pdf">Selected Genes by PBNPA</a></li>
</ul>
<p><img src="../assets/sgrna/Selected_genes_PBNPA-4.png" alt="Selected Genes by PBNPA" width="50%"><img src="../assets/sgrna/Selected_genes_PBNPA-5.png" alt="Selected Genes by PBNPA" width="50%"></p>
<ul>
<li><a href="../assets/sgrna/Trimming_statistics.pdf">Trimming Statistics</a></li>
</ul>
<p><img src="../assets/sgrna/Trimming_statistics-1.png" alt="Trimming Statistics" width="33.3%"><img src="../assets/sgrna/Trimming_statistics-3.png" alt="Trimming Statistics" width="33.3%"><img src="../assets/sgrna/Trimming_statistics-4.png" alt="Trimming Statistics" width="33.3%"></p>
<p>Finally, let's perfom the test again using an FDR threshold of 0.1. For that,
you do not need to execute all the previous steps, only the assessment of gene
significance.</p>
<p>It can be done like this:</p>
<div class="highlight"><pre><span></span><code>CASPR <span class="se">\</span>
  --start <span class="nb">test</span> -y <span class="m">0</span>.1 -k <span class="se">\</span>
  --output-dir ./results <span class="se">\</span>
  --controls controlfile.txt <span class="se">\</span>
  --exper-design expdesign.txt
</code></pre></div>

<p>The results should be exactly the same as above, but fewer hits are displayed in
the plots. This option ensures that you can perform analyses of CRISPR screens
not only starting rom the raw sequencing data, but also beginning from a table
of read counts.</p>
<p>If you kept the intermediate files in this last step, you can visualize again
the results with VISPR:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Run VIPR server</span>
vispr server ./results/config* --port <span class="m">6000</span>
<span class="c1"># Ctrl-C to exit the server</span>
</code></pre></div>

<div class="admonition info">
<p class="admonition-title">Users of IBU Cluster</p>
<p>VISPR installation in the IBU cluster might not be updated. Therefore,
users of this cluster will need to run an additional command to see
the outputs:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Take VISPR from jpijuan Conda Environment</span>
<span class="nb">alias</span> <span class="nv">vispr</span><span class="o">=</span><span class="s2">&quot;/home/jpijuan/miniconda3/envs/vispr/bin/vispr&quot;</span>

<span class="c1"># Run VIPR server</span>
vispr server ./results/config* --port <span class="m">6000</span>
<span class="c1"># Ctrl-C to exit the server</span>
</code></pre></div>

</div>
<p>Also keep in mind that, if you work from a cluster, you will need to copy the following
line locally on your computer in order to see the results:</p>
<div class="highlight"><pre><span></span><code>ssh -f <span class="o">{</span>user<span class="o">}</span>@binfservms01.unibe.ch -L <span class="m">6000</span>:localhost:6000 -N
</code></pre></div>

<p>The data should be already available at this <a href="http://127.0.0.1:6000">webpage</a>.</p>
<p>Now that you arrived here, you are totally ready to use CASPR with your CRISPR data.
Enjoy!</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../usage/" title="Usage" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Usage
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 Judith Bergad√† Pijuan
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/judithbergada/CASPR" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.92ffa368.min.js"></script>
      <script src="../assets/javascripts/bundle.5123e3d4.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>